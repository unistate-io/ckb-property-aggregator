{"version":3,"file":"paramsFormatter.js","names":["_exceptions","require","_bi","formatter","toOptional","format","arg","undefined","toArray","Array","isArray","map","toHash","hash","StringHashTypeException","startsWith","toNumber","number","toString","BigintOrHexStringTypeException","HexStringWithout0xException","toScript","script","codeHash","hashType","hash_type","rest","code_hash","toOutPoint","outPoint","txHash","index","tx_hash","toInput","input","previousOutput","since","previous_output","toOutput","output","capacity","lock","type","toDepType","toOrder","order","toCellDep","cellDep","depType","out_point","dep_type","toRawTransaction","transaction","version","cellDeps","inputs","outputs","outputsData","outputs_data","headerDeps","header_deps","formattedInputs","formattedOutputs","formattedCellDeps","tx","cell_deps","toPageNumber","pageNo","toPageSize","pageSize","size","BI","from","MAX_SIZE","MIN_SIZE","gt","PageSizeTooLargeException","lt","PageSizeTooSmallException","toReverseOrder","reverse","toOutputsValidator","outputsValidator","VALIDATORS","indexOf","OutputsValidatorTypeException","toBoolean","value","toTransactionProof","proof","blockHash","block_hash","witnessesRoot","witnesses_root","toTransactionAndWitnessProof","witnesses_proof","witnessesProof","transactions_proof","transactionsProof","toSearchFilter","data","output_data_len_range","outputDataLenRange","output_capacity_range","outputCapacityRange","block_range","blockRange","script_len_range","scriptLenRange","toSearchKey","script_type","scriptType","filter","script_search_mode","scriptSearchMode","toGetCellsSearchKey","with_data","withData","toGetTransactionsSearchKey","group_by_transaction","groupByTransaction","exports"],"sources":["../src/paramsFormatter.ts"],"sourcesContent":["import {\n  PageSizeTooLargeException,\n  PageSizeTooSmallException,\n  OutputsValidatorTypeException,\n  BigintOrHexStringTypeException,\n  StringHashTypeException,\n  HexStringWithout0xException,\n} from \"./exceptions\";\nimport { BI } from \"@ckb-lumos/bi\";\nimport { RPC } from \"./types/rpc\";\nimport { CKBComponents } from \"./types/api\";\n\n/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\nexport const formatter = {\n  toOptional: (format?: (args: any) => any) => (arg: any) => {\n    if (!format || arg === undefined || arg === null) {\n      return arg;\n    }\n    return format(arg);\n  },\n  toArray: (format?: (args: any) => any) => (arg: any) => {\n    if (typeof format !== \"function\" || !Array.isArray(arg)) {\n      return arg;\n    }\n    return arg.map(format);\n  },\n  toHash: (hash: string): RPC.Hash256 => {\n    if (typeof hash !== \"string\") {\n      throw new StringHashTypeException(hash);\n    }\n    return hash.startsWith(\"0x\") ? hash : `0x${hash}`;\n  },\n  toNumber: (number: CKBComponents.Number | bigint): RPC.Number => {\n    if (typeof number === \"bigint\") {\n      return `0x${number.toString(16)}`;\n    }\n    if (typeof number !== \"string\") {\n      throw new BigintOrHexStringTypeException(number);\n    }\n    if (!number.startsWith(\"0x\")) {\n      throw new HexStringWithout0xException(number);\n    }\n    return number;\n  },\n  toScript: (script: CKBComponents.Script): RPC.Script => {\n    const { codeHash, hashType: hash_type, ...rest } = script;\n    return {\n      code_hash: formatter.toHash(codeHash),\n      hash_type,\n      ...rest,\n    };\n  },\n  toOutPoint: (outPoint: CKBComponents.OutPoint): RPC.OutPoint => {\n    const { txHash, index, ...rest } = outPoint;\n    return {\n      tx_hash: formatter.toHash(txHash),\n      index: formatter.toNumber(index),\n      ...rest,\n    };\n  },\n  toInput: (input: CKBComponents.CellInput): RPC.CellInput => {\n    if (!input) return input;\n    const { previousOutput, since, ...rest } = input;\n    return {\n      previous_output: formatter.toOutPoint(previousOutput),\n      since: formatter.toNumber(since),\n      ...rest,\n    };\n  },\n  toOutput: (output: CKBComponents.CellOutput): RPC.CellOutput => {\n    if (!output) return output;\n    const { capacity, lock, type = undefined, ...rest } = output;\n    return {\n      capacity: formatter.toNumber(capacity),\n      lock: formatter.toScript(lock),\n      type: type ? formatter.toScript(type) : type,\n      ...rest,\n    };\n  },\n  toDepType: (type: CKBComponents.DepType) => {\n    if (type === \"depGroup\") {\n      return \"dep_group\";\n    }\n    return type;\n  },\n  toOrder: (order: CKBComponents.Order) => {\n    return order;\n  },\n  toCellDep: (cellDep: CKBComponents.CellDep): RPC.CellDep => {\n    if (!cellDep) return cellDep;\n    const { outPoint, depType = \"code\", ...rest } = cellDep;\n    return {\n      out_point: formatter.toOutPoint(outPoint),\n      dep_type: formatter.toDepType(depType),\n      ...rest,\n    };\n  },\n  toRawTransaction: (\n    transaction: CKBComponents.RawTransaction\n  ): RPC.RawTransaction => {\n    if (!transaction) return transaction;\n    const {\n      version,\n      cellDeps = [],\n      inputs = [],\n      outputs = [],\n      outputsData: outputs_data = [],\n      headerDeps: header_deps = [],\n      ...rest\n    } = transaction;\n    const formattedInputs = inputs.map((input) => formatter.toInput(input));\n    const formattedOutputs = outputs.map((output) =>\n      formatter.toOutput(output)\n    );\n    const formattedCellDeps = cellDeps.map((cellDep) =>\n      formatter.toCellDep(cellDep)\n    );\n    const tx = {\n      version: formatter.toNumber(version),\n      cell_deps: formattedCellDeps,\n      inputs: formattedInputs,\n      outputs: formattedOutputs,\n      outputs_data,\n      header_deps,\n      ...rest,\n    };\n    return tx;\n  },\n  toPageNumber: (pageNo: string | bigint = \"0x1\") => formatter.toNumber(pageNo),\n  toPageSize: (pageSize: string | bigint = \"0x32\") => {\n    const size = BI.from(pageSize);\n    const MAX_SIZE = 50;\n    const MIN_SIZE = 0;\n    if (BI.from(size).gt(MAX_SIZE))\n      throw new PageSizeTooLargeException(pageSize, MAX_SIZE);\n    if (BI.from(size).lt(MIN_SIZE))\n      throw new PageSizeTooSmallException(pageSize, MIN_SIZE);\n    return formatter.toNumber(`0x${size.toString(16)}`);\n  },\n  toReverseOrder: (reverse = false) => !!reverse,\n  toOutputsValidator: (outputsValidator: CKBComponents.OutputsValidator) => {\n    if (!outputsValidator) return undefined;\n    const VALIDATORS = [\"default\", \"passthrough\"];\n    if (VALIDATORS.indexOf(outputsValidator) > -1) {\n      return outputsValidator;\n    }\n    throw new OutputsValidatorTypeException();\n  },\n  toBoolean: (value: boolean) => {\n    return !!value;\n  },\n  toTransactionProof: (\n    proof: CKBComponents.TransactionProof\n  ): RPC.TransactionProof => {\n    if (!proof) return proof;\n    const {\n      blockHash: block_hash,\n      witnessesRoot: witnesses_root,\n      ...rest\n    } = proof;\n    return {\n      block_hash,\n      witnesses_root,\n      ...rest,\n    };\n  },\n\n  toTransactionAndWitnessProof: (\n    proof: CKBComponents.TransactionAndWitnessProof\n  ): RPC.TransactionAndWitnessProof => {\n    return {\n      block_hash: proof.blockHash,\n      witnesses_proof: proof.witnessesProof,\n      transactions_proof: proof.transactionsProof,\n    };\n  },\n\n  toSearchFilter: (data: CKBComponents.SearchFilter): RPC.SearchFilter => {\n    if (!data) return data;\n    return {\n      script: data.script ? formatter.toScript(data.script) : data.script,\n      output_data_len_range: data.outputDataLenRange,\n      output_capacity_range: data.outputCapacityRange,\n      block_range: data.blockRange,\n      script_len_range: data.scriptLenRange,\n    };\n  },\n  toSearchKey: (data: CKBComponents.SearchKey): RPC.SearchKey => {\n    if (!data) return data;\n    return {\n      script: formatter.toScript(data.script),\n      script_type: data.scriptType,\n      filter: data.filter ? formatter.toSearchFilter(data.filter) : data.filter,\n      script_search_mode: data.scriptSearchMode\n        ? data.scriptSearchMode\n        : \"prefix\",\n    };\n  },\n  toGetCellsSearchKey: (\n    data: CKBComponents.GetCellsSearchKey\n  ): RPC.GetCellsSearchKey => {\n    if (!data) return data;\n    return {\n      ...formatter.toSearchKey(data),\n      with_data: data.withData,\n    };\n  },\n  toGetTransactionsSearchKey: (\n    data: CKBComponents.GetTransactionsSearchKey\n  ): RPC.GetTransactionsSearchKey => {\n    if (!data) return data;\n    return {\n      ...formatter.toSearchKey(data),\n      group_by_transaction: data.groupByTransaction,\n    };\n  },\n};\n/* eslint-enable camelcase, @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\n"],"mappings":"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"}