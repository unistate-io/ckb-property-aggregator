{"version":3,"file":"reader.js","names":["BaseReader","constructor","__isByteLikeReader__","isReader","x","ArrayBufferReader","buffer","view","DataView","length","byteLength","indexAt","i","getUint8","toArrayBuffer","serializeJson","Array","prototype","map","call","Uint8Array","toString","slice","join","HexStringReader","string","parseInt","substr","ArrayBuffer","setUint8","Reader","input","startsWith","Error","from","fromRawString","c","charCodeAt","exports"],"sources":["../src/reader.js"],"sourcesContent":["class BaseReader {\n  constructor() {\n    /**\n     * instanceof would be nice here, but when a user use multi version of Reader that may cause problem\n     * @example\n     * const { Reader } = require('ckb-js-toolkit'); // ckb-js-toolkit@0.100.1\n     * const { readSomething } = require('other-serializer-lib'); // dependent on ckb-js-toolkit@0.100.0\n     *\n     * readSomething() instanceof Reader; // false\n     *\n     * @type {boolean}\n     * @protected\n     */\n    this.__isByteLikeReader__ = true;\n  }\n\n  static isReader(x) {\n    if (x == null) return false;\n    if (x instanceof BaseReader) return true;\n    return x.__isByteLikeReader__ === true;\n  }\n}\n\nclass ArrayBufferReader extends BaseReader {\n  constructor(buffer) {\n    super();\n    this.view = new DataView(buffer);\n  }\n\n  length() {\n    return this.view.byteLength;\n  }\n\n  indexAt(i) {\n    return this.view.getUint8(i);\n  }\n\n  toArrayBuffer() {\n    return this.view.buffer;\n  }\n\n  serializeJson() {\n    return (\n      \"0x\" +\n      Array.prototype.map\n        .call(new Uint8Array(this.view.buffer), (x) =>\n          (\"00\" + x.toString(16)).slice(-2)\n        )\n        .join(\"\")\n    );\n  }\n}\n\nclass HexStringReader extends BaseReader {\n  constructor(string) {\n    super();\n    this.string = string;\n  }\n\n  length() {\n    return this.string.length / 2 - 1;\n  }\n\n  indexAt(i) {\n    return parseInt(this.string.substr(2 + i * 2, 2), 16);\n  }\n\n  toArrayBuffer() {\n    const buffer = new ArrayBuffer(this.length());\n    const view = new DataView(buffer);\n\n    for (let i = 0; i < this.length(); i++) {\n      view.setUint8(i, this.indexAt(i));\n    }\n    return buffer;\n  }\n\n  serializeJson() {\n    return this.string;\n  }\n}\n/**\n * @deprecated please follow the {@link https://lumos-website.vercel.app/migrations/migrate-to-v0.19 migration-guide}\n */\nexport class Reader extends BaseReader {\n  constructor(input) {\n    super();\n    if (\n      input instanceof HexStringReader ||\n      input instanceof ArrayBufferReader\n    ) {\n      return input;\n    }\n    if (typeof input === \"string\") {\n      if (!input.startsWith(\"0x\") || input.length % 2 !== 0) {\n        throw new Error(\n          \"Hex string must start with 0x, and has even numbered length!\"\n        );\n      }\n      return new HexStringReader(input);\n    }\n    if (input instanceof ArrayBuffer) {\n      return new ArrayBufferReader(input);\n    }\n    if (input instanceof Uint8Array) {\n      return new ArrayBufferReader(Uint8Array.from(input).buffer);\n    }\n    throw new Error(\"Reader can only accept hex string or ArrayBuffer!\");\n  }\n\n  static from(x) {\n    return new Reader(x);\n  }\n\n  static fromRawString(string) {\n    const buffer = new ArrayBuffer(string.length);\n    const view = new DataView(buffer);\n\n    for (let i = 0; i < string.length; i++) {\n      const c = string.charCodeAt(i);\n      if (c > 0xff) {\n        throw new Error(\"fromRawString can only accept UTF-8 raw string!\");\n      }\n      view.setUint8(i, c);\n    }\n    return new ArrayBufferReader(buffer);\n  }\n}\n"],"mappings":"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"}