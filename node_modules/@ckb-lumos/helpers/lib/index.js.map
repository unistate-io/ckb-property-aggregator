{"version":3,"file":"index.js","names":["_codec","require","_base","_bech","_immutable","_configManager","_bi","_addressToScript","_utils","_toolkit","_blockchain","bytify","hexify","bytes","BECH32_LIMIT","minimalScriptCapacity","script","validate","result","minimalScriptCapacityCompatible","BigInt","toString","validators","ValidateScript","codeHash","length","args","BI","from","mul","minimalCellCapacity","fullCell","minimalCellCapacityCompatible","blockchain","CellOutput","pack","cellOutput","lock","type","data","locateCellDep","config","undefined","getConfig","scriptTemplate","Object","values","SCRIPTS","find","s","CODE_HASH","HASH_TYPE","hashType","depType","DEP_TYPE","outPoint","txHash","TX_HASH","index","INDEX","HAS_WARNED_FOR_DEPRECATED_ADDRESS","generateAddress","console","warn","SHORT_ID","push","hexToByteArray","Error","words","bech32","toWords","encode","PREFIX","scriptToAddress","exports","generatePredefinedAddress","scriptType","template","availableKeys","keys","generateSecp256k1Blake160Address","generateSecp256k1Blake160MultisigAddress","parseAddress","address","parseFullFormatAddress","parseDeprecatedCkb2019Address","addressToScript","encodeToAddress","concat","HashType","bech32m","encodeToConfigAddress","options","String","TransactionSkeleton","Record","cellProvider","cellDeps","List","headerDeps","inputs","outputs","witnesses","fixedEntries","signingEntries","inputSinces","ImmutableMap","createTransactionFromSkeleton","txSkeleton","tx","version","get","toArray","map","input","i","since","previousOutput","output","outputsData","ValidateTransaction","createTransactionSkeleton","transaction","fetcher","update","inputCells","Promise","all","reduce","set","outputCells","_transaction$outputsD","sealTransaction","sealingContents","size","forEach","e","witness","witnessArgs","WitnessArgs","unpack","newWitnessArgs","inputType","outputType","transactionSkeletonToObject","txSkelton","toJS","objectToTransactionSkeleton","obj","key","value","entries"],"sources":["../src/index.ts"],"sourcesContent":["import { bytes } from \"@ckb-lumos/codec\";\nimport {\n  Address,\n  Cell,\n  CellDep,\n  CellProvider,\n  Hash,\n  HexString,\n  PackedSince,\n  Script,\n  Transaction,\n  WitnessArgs,\n  blockchain,\n  OutPoint,\n} from \"@ckb-lumos/base\";\nimport { bech32, bech32m } from \"bech32\";\nimport { List, Map as ImmutableMap, Record } from \"immutable\";\nimport { Config, getConfig, predefined } from \"@ckb-lumos/config-manager\";\nimport { BI } from \"@ckb-lumos/bi\";\nimport {\n  parseDeprecatedCkb2019Address,\n  parseFullFormatAddress,\n} from \"./address-to-script\";\nimport { hexToByteArray } from \"./utils\";\nimport { validators } from \"@ckb-lumos/toolkit\";\nimport { HashType } from \"@ckb-lumos/base/lib/blockchain\";\n\nconst { bytify, hexify } = bytes;\nexport interface Options {\n  config?: Config;\n}\n\nconst BECH32_LIMIT = 1023;\n\nexport function minimalScriptCapacity(\n  script: Script,\n  { validate = true }: { validate?: boolean } = {}\n): bigint {\n  const result = minimalScriptCapacityCompatible(script, { validate });\n  return BigInt(result.toString());\n}\n\nexport function minimalScriptCapacityCompatible(\n  script: Script,\n  { validate = true }: { validate?: boolean } = {}\n): BI {\n  if (validate) {\n    validators.ValidateScript(script);\n  }\n\n  let bytes = 0;\n  bytes += bytify(script.codeHash).length;\n  bytes += bytify(script.args).length;\n  // hash_type field\n  bytes += 1;\n\n  return BI.from(bytes).mul(100000000);\n}\n\nexport function minimalCellCapacity(\n  fullCell: Cell,\n  { validate = true }: { validate?: boolean } = {}\n): bigint {\n  const result = minimalCellCapacityCompatible(fullCell, { validate });\n  return BigInt(result.toString());\n}\n\nexport function minimalCellCapacityCompatible(\n  fullCell: Cell,\n  { validate = true }: { validate?: boolean } = {}\n): BI {\n  if (validate) {\n    blockchain.CellOutput.pack(fullCell.cellOutput);\n  }\n  // Capacity field itself\n  let bytes = 8;\n  bytes += bytify(fullCell.cellOutput.lock.codeHash).length;\n  bytes += bytify(fullCell.cellOutput.lock.args).length;\n  // hashType field\n  bytes += 1;\n  if (fullCell.cellOutput.type) {\n    bytes += bytify(fullCell.cellOutput.type.codeHash).length;\n    bytes += bytify(fullCell.cellOutput.type.args).length;\n    bytes += 1;\n  }\n  if (fullCell.data) {\n    bytes += bytify(fullCell.data).length;\n  }\n  return BI.from(bytes).mul(100000000);\n}\n\nexport function locateCellDep(\n  script: Script,\n  { config = undefined }: Options = {}\n): CellDep | null {\n  config = config || getConfig();\n  const scriptTemplate = Object.values(config.SCRIPTS).find(\n    (s) =>\n      s && s.CODE_HASH === script.codeHash && s.HASH_TYPE === script.hashType\n  );\n\n  if (scriptTemplate) {\n    return {\n      depType: scriptTemplate.DEP_TYPE,\n      outPoint: {\n        txHash: scriptTemplate.TX_HASH,\n        index: scriptTemplate.INDEX,\n      },\n    };\n  }\n  return null;\n}\n\nlet HAS_WARNED_FOR_DEPRECATED_ADDRESS = false;\n\n/**\n * @deprecated please migrate to {@link encodeToAddress}, the short format address will be removed in the future\n * @param script\n * @param param1\n * @returns\n */\nexport function generateAddress(\n  script: Script,\n  { config = undefined }: Options = {}\n): Address {\n  config = config || getConfig();\n  if (!HAS_WARNED_FOR_DEPRECATED_ADDRESS) {\n    console.warn(\n      \"The address format generated by generateAddress or scriptToAddress will be deprecated, please migrate to encodeToAddress to generate the new ckb2021 full format address as soon as possible\"\n    );\n    HAS_WARNED_FOR_DEPRECATED_ADDRESS = true;\n  }\n  validators.ValidateScript(script);\n\n  const scriptTemplate = Object.values(config.SCRIPTS).find(\n    (s) =>\n      s && s.CODE_HASH === script.codeHash && s.HASH_TYPE === script.hashType\n  );\n  const data = [];\n  if (scriptTemplate && scriptTemplate.SHORT_ID !== undefined) {\n    data.push(1, scriptTemplate.SHORT_ID);\n    data.push(...hexToByteArray(script.args));\n  } else {\n    if (script.hashType === \"type\") data.push(0x04);\n    else if (script.hashType === \"data\") data.push(0x02);\n    else throw new Error(`Invalid hashType ${script.hashType}`);\n\n    data.push(...hexToByteArray(script.codeHash));\n    data.push(...hexToByteArray(script.args));\n  }\n  const words = bech32.toWords(data);\n  return bech32.encode(config.PREFIX, words, BECH32_LIMIT);\n}\n\n/**\n * @deprecated please migrate to {@link encodeToAddress}, the short format address will be removed in the future */\nexport const scriptToAddress = generateAddress;\n\n/**\n * @deprecated please migrate to {@link encodeToConfigAddress}\n * @param args\n * @param scriptType\n * @param param2\n * @returns\n */\nfunction generatePredefinedAddress(\n  args: HexString,\n  scriptType: string,\n  { config = undefined }: Options = {}\n): Address {\n  config = config || getConfig();\n  const template = config.SCRIPTS[scriptType];\n  if (!template) {\n    const availableKeys = Object.keys(config.SCRIPTS);\n    throw new Error(\n      `Invalid script type: ${scriptType}, only support: ${availableKeys}`\n    );\n  }\n  const script: Script = {\n    codeHash: template.CODE_HASH,\n    hashType: template.HASH_TYPE,\n    args,\n  };\n\n  return generateAddress(script, { config });\n}\n\n/**\n * @deprecated please migrate to {@link encodeToConfigAddress}\n * @param args\n * @param param1\n * @returns\n */\nexport function generateSecp256k1Blake160Address(\n  args: HexString,\n  { config = undefined }: Options = {}\n): Address {\n  return generatePredefinedAddress(args, \"SECP256K1_BLAKE160\", { config });\n}\n\n/**\n * @deprecated please migrate to {@link encodeToConfigAddress}\n * @param args\n * @param config\n */\nexport function generateSecp256k1Blake160MultisigAddress(\n  args: HexString,\n  { config = undefined }: Options = {}\n): Address {\n  return generatePredefinedAddress(args, \"SECP256K1_BLAKE160_MULTISIG\", {\n    config,\n  });\n}\n\nexport function parseAddress(\n  address: Address,\n  { config = undefined }: Options = {}\n): Script {\n  config = config || getConfig();\n\n  try {\n    return parseFullFormatAddress(address, { config });\n  } catch {\n    return parseDeprecatedCkb2019Address(address, { config });\n  }\n}\n\nexport const addressToScript = parseAddress;\n\n/**\n * parse a lock script to an address\n * @param script\n * @param config\n */\nexport function encodeToAddress(\n  script: Script,\n  { config = undefined }: Options = {}\n): Address {\n  validators.ValidateScript(script);\n  config = config || getConfig();\n  // https://github.com/nervosnetwork/rfcs/blob/9aef152a5123c8972de1aefc11794cf84d1762ed/rfcs/0021-ckb-address-format/0021-ckb-address-format.md#full-payload-format\n  // Full payload format directly encodes all data fields of lock script. The encode rule of full payload format is Bech32m.\n  // payload = 0x00 | code_hash | hash_type | args\n\n  const data = bytes.concat(\n    [0x00],\n    script.codeHash,\n    HashType.pack(script.hashType),\n    script.args\n  );\n\n  return bech32m.encode(config.PREFIX, bech32m.toWords(data), BECH32_LIMIT);\n}\n\ntype PredefinedScriptName = keyof typeof predefined.LINA.SCRIPTS;\n\nexport function encodeToConfigAddress(\n  args: HexString,\n  scriptType: PredefinedScriptName\n): string;\nexport function encodeToConfigAddress<C extends Config>(\n  args: HexString,\n  scriptType: keyof C[\"SCRIPTS\"],\n  options: { config?: C }\n): string;\n/**\n * encode a script to an address with args and a key of config\n * @example\n * ```ts\n * // parse a predefined lock to an address\n * encodeToConfigAddress('0x12345678123456781234567812345678', 'SECP256K1_BLAKE160');\n * // parse a custom lock to an address\n * encodeToConfigAddress('0x12345678123456781234567812345678', 'MY_CUSTOM_LOCK', {\n *   SCRIPTS: {\n *     MY_CUSTOM_LOCK: {...}\n *   }\n * })\n * ```\n * @param args script args\n * @param scriptType a key of `config.SCRIPTS`\n * @param options\n * @returns\n */\nexport function encodeToConfigAddress<C extends Config>(\n  args: HexString,\n  scriptType: keyof C[\"SCRIPTS\"],\n  options?: { config?: C }\n): string {\n  const config = (options?.config || getConfig()) as C;\n  const template = config.SCRIPTS[scriptType as string];\n\n  if (!template) {\n    const availableKeys = Object.keys(config.SCRIPTS);\n    throw new Error(\n      // prettier-ignore\n      `Invalid script type: ${String(scriptType)}, only support: ${availableKeys}`\n    );\n  }\n\n  const script: Script = {\n    codeHash: template.CODE_HASH,\n    hashType: template.HASH_TYPE,\n    args,\n  };\n\n  return encodeToAddress(script, { config });\n}\n\nexport interface TransactionSkeletonInterface {\n  cellProvider: CellProvider | null;\n  cellDeps: List<CellDep>;\n  headerDeps: List<Hash>;\n  inputs: List<Cell>;\n  outputs: List<Cell>;\n  witnesses: List<HexString>;\n  fixedEntries: List<{ field: string; index: number }>;\n  signingEntries: List<{ type: string; index: number; message: string }>;\n  inputSinces: ImmutableMap<number, PackedSince>;\n}\n\nexport type TransactionSkeletonType = Record<TransactionSkeletonInterface> &\n  Readonly<TransactionSkeletonInterface>;\n\nexport const TransactionSkeleton = Record<TransactionSkeletonInterface>({\n  cellProvider: null,\n  cellDeps: List(),\n  headerDeps: List(),\n  inputs: List(),\n  outputs: List(),\n  witnesses: List(),\n  fixedEntries: List(),\n  signingEntries: List(),\n  inputSinces: ImmutableMap(),\n});\n\nexport function createTransactionFromSkeleton(\n  txSkeleton: TransactionSkeletonType,\n  { validate = true }: { validate?: boolean } = {}\n): Transaction {\n  const tx: Transaction = {\n    version: \"0x0\",\n    cellDeps: txSkeleton.get(\"cellDeps\").toArray(),\n    headerDeps: txSkeleton.get(\"headerDeps\").toArray(),\n    inputs: txSkeleton\n      .get(\"inputs\")\n      .map((input, i) => {\n        if (!input.outPoint) {\n          throw new Error(\n            `cannot find OutPoint in Inputs[${i}] when createTransactionFromSkeleton`\n          );\n        }\n        return {\n          since: txSkeleton.get(\"inputSinces\").get(i, \"0x0\"),\n          previousOutput: input.outPoint,\n        };\n      })\n      .toArray(),\n    outputs: txSkeleton\n      .get(\"outputs\")\n      .map((output) => output.cellOutput)\n      .toArray(),\n    outputsData: txSkeleton\n      .get(\"outputs\")\n      .map((output) => output.data || \"0x0\")\n      .toArray(),\n    witnesses: txSkeleton.get(\"witnesses\").toArray(),\n  };\n  if (validate) {\n    validators.ValidateTransaction(tx);\n  }\n  return tx;\n}\n\ntype Promisable<T> = Promise<T> | T;\nexport type LiveCellFetcher = (outPoint: OutPoint) => Promisable<Cell>;\n\n/**\n * create a {@link TransactionSkeleton} from a {@link Transaction}\n * @example\n * ```js\n * const rpc = new RPC('localhost:8114')\n * const fetcher = (outPoint: OutPoint) => rpc.getLiveCell(outPoint)\n * const skeleton = await createTransactionSkeleton({ transaction, fetcher });\n * ```\n */\nexport async function createTransactionSkeleton(\n  transaction: Transaction,\n  fetcher: LiveCellFetcher\n): Promise<TransactionSkeletonType> {\n  let txSkeleton = TransactionSkeleton();\n  txSkeleton = txSkeleton.update(\"cellDeps\", (cellDeps) =>\n    cellDeps.push(...transaction.cellDeps)\n  );\n\n  txSkeleton = txSkeleton.update(\"headerDeps\", (headerDeps) =>\n    headerDeps.push(...transaction.headerDeps)\n  );\n\n  const inputCells = await Promise.all(\n    transaction.inputs.map((input) => fetcher(input.previousOutput))\n  );\n  txSkeleton = txSkeleton.update(\"inputs\", (inputs) =>\n    inputs.push(...inputCells)\n  );\n\n  txSkeleton = txSkeleton.update(\"inputSinces\", (inputSinces) =>\n    transaction.inputs.reduce(\n      (map, input, i) => map.set(i, input.since),\n      inputSinces\n    )\n  );\n\n  const outputCells: Array<Cell> = transaction.outputs.map((output, index) => ({\n    cellOutput: output,\n    data: transaction.outputsData[index] ?? \"0x\",\n  }));\n\n  txSkeleton = txSkeleton.update(\"outputs\", (outputs) =>\n    outputs.push(...outputCells)\n  );\n  txSkeleton = txSkeleton.update(\"witnesses\", (witnesses) =>\n    witnesses.push(...transaction.witnesses)\n  );\n\n  return txSkeleton;\n}\n\nexport function sealTransaction(\n  txSkeleton: TransactionSkeletonType,\n  sealingContents: HexString[]\n): Transaction {\n  const tx = createTransactionFromSkeleton(txSkeleton);\n  if (sealingContents.length !== txSkeleton.get(\"signingEntries\").size) {\n    throw new Error(\n      `Requiring ${\n        txSkeleton.get(\"signingEntries\").size\n      } sealing contents but provided ${sealingContents.length}!`\n    );\n  }\n  txSkeleton.get(\"signingEntries\").forEach((e, i) => {\n    switch (e.type) {\n      case \"witness_args_lock\": {\n        const witness = tx.witnesses[e.index];\n        const witnessArgs = blockchain.WitnessArgs.unpack(bytify(witness));\n        const newWitnessArgs: WitnessArgs = {\n          lock: sealingContents[i],\n        };\n        const inputType = witnessArgs.inputType;\n        if (inputType) {\n          newWitnessArgs.inputType = inputType;\n        }\n        const outputType = witnessArgs.outputType;\n        if (outputType) {\n          newWitnessArgs.outputType = outputType;\n        }\n\n        tx.witnesses[e.index] = hexify(\n          blockchain.WitnessArgs.pack(newWitnessArgs)\n        );\n        break;\n      }\n      default:\n        throw new Error(`Invalid signing entry type: ${e.type}`);\n    }\n  });\n  return tx;\n}\n\nexport interface TransactionSkeletonObject {\n  cellProvider: CellProvider | null;\n  cellDeps: CellDep[];\n  headerDeps: Hash[];\n  inputs: Cell[];\n  outputs: Cell[];\n  witnesses: HexString[];\n  fixedEntries: Array<{ field: string; index: number }>;\n  signingEntries: Array<{ type: string; index: number; message: string }>;\n  inputSinces: Map<number, PackedSince>;\n}\n\n/**\n * Convert TransactionSkeleton to js object\n *\n * @param txSkelton\n */\nexport function transactionSkeletonToObject(\n  txSkelton: TransactionSkeletonType\n): TransactionSkeletonObject {\n  return txSkelton.toJS() as TransactionSkeletonObject;\n}\n\n/**\n * Convert js object to TransactionSkeleton\n *\n * @param obj\n */\nexport function objectToTransactionSkeleton(\n  obj: TransactionSkeletonObject\n): TransactionSkeletonType {\n  let inputSinces = ImmutableMap<number, PackedSince>();\n  for (const [key, value] of Object.entries(obj.inputSinces)) {\n    inputSinces = inputSinces.set(+key, value);\n  }\n  const txSkeleton = TransactionSkeleton({\n    cellProvider: obj.cellProvider,\n    cellDeps: List(obj.cellDeps),\n    headerDeps: List(obj.headerDeps),\n    inputs: List(obj.inputs),\n    outputs: List(obj.outputs),\n    witnesses: List(obj.witnesses),\n    fixedEntries: List(obj.fixedEntries),\n    signingEntries: List(obj.signingEntries),\n    inputSinces,\n  });\n  return txSkeleton;\n}\n"],"mappings":"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"}