{"version":3,"file":"rpc.js","names":["_base","require","_crossFetch","_interopRequireDefault","_paramsFormatter","obj","__esModule","default","RPC","constructor","uri","getTip","utils","deepCamel","request","getCells","searchKey","order","limit","cursor","params","toGetCellsSearchKey","getTransactions","toGetTransactionsSearchKey","getIndexerInfo","exports","ckbIndexerUrl","method","res","fetch","body","JSON","stringify","id","jsonrpc","headers","status","Error","data","json","error","undefined","result"],"sources":["../src/rpc.ts"],"sourcesContent":["import { HexString, Tip, utils } from \"@ckb-lumos/base\";\nimport {\n  GetLiveCellsResult,\n  IndexerTransactionList,\n  Order,\n  GetCellsSearchKey,\n  GetTransactionsSearchKey,\n} from \"./type\";\nimport fetch from \"cross-fetch\";\nimport {\n  toGetCellsSearchKey,\n  toGetTransactionsSearchKey,\n} from \"./paramsFormatter\";\n\nexport class RPC {\n  private uri: string;\n\n  /**\n   *\n   * @param uri  indexer uri\n   */\n  constructor(uri: string) {\n    this.uri = uri;\n  }\n\n  async getTip(): Promise<Tip> {\n    return utils.deepCamel(await request(this.uri, \"get_tip\"));\n  }\n  async getCells<WithData extends boolean = true>(\n    searchKey: GetCellsSearchKey<WithData>,\n    order: Order,\n    limit: HexString,\n    cursor?: string\n  ): Promise<GetLiveCellsResult<WithData>> {\n    const params = [toGetCellsSearchKey(searchKey), order, limit, cursor];\n    return utils.deepCamel(await request(this.uri, \"get_cells\", params));\n  }\n\n  async getTransactions<Grouped extends boolean = false>(\n    searchKey: GetTransactionsSearchKey<Grouped>,\n    order: Order,\n    limit: HexString,\n    cursor?: string\n  ): Promise<IndexerTransactionList<Grouped>> {\n    const params = [\n      toGetTransactionsSearchKey(searchKey),\n      order,\n      limit,\n      cursor,\n    ];\n    return utils.deepCamel(await request(this.uri, \"get_transactions\", params));\n  }\n  async getIndexerInfo(): Promise<string> {\n    return utils.deepCamel(await request(this.uri, \"get_indexer_info\"));\n  }\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\nconst request = async (\n  ckbIndexerUrl: string,\n  method: string,\n  params?: any\n): Promise<any> => {\n  const res = await fetch(ckbIndexerUrl, {\n    method: \"POST\",\n    body: JSON.stringify({\n      id: 0,\n      jsonrpc: \"2.0\",\n      method,\n      params,\n    }),\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n  });\n  if (res.status !== 200) {\n    throw new Error(`indexer request failed with HTTP code ${res.status}`);\n  }\n  const data = await res.json();\n  if (data.error !== undefined) {\n    throw new Error(\n      `indexer request rpc failed with error: ${JSON.stringify(data.error)}`\n    );\n  }\n  return data.result;\n};\n/* eslint-enalbe @typescript-eslint/no-explicit-any, @typescript-eslint/explicit-module-boundary-types */\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AAQA,IAAAC,WAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,gBAAA,GAAAH,OAAA;AAG2B,SAAAE,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEpB,MAAMG,GAAG,CAAC;EAGf;AACF;AACA;AACA;EACEC,WAAWA,CAACC,GAAW,EAAE;IACvB,IAAI,CAACA,GAAG,GAAGA,GAAG;EAChB;EAEA,MAAMC,MAAMA,CAAA,EAAiB;IAC3B,OAAOC,WAAK,CAACC,SAAS,CAAC,MAAMC,OAAO,CAAC,IAAI,CAACJ,GAAG,EAAE,SAAS,CAAC,CAAC;EAC5D;EACA,MAAMK,QAAQA,CACZC,SAAsC,EACtCC,KAAY,EACZC,KAAgB,EAChBC,MAAe,EACwB;IACvC,MAAMC,MAAM,GAAG,CAAC,IAAAC,oCAAmB,EAACL,SAAS,CAAC,EAAEC,KAAK,EAAEC,KAAK,EAAEC,MAAM,CAAC;IACrE,OAAOP,WAAK,CAACC,SAAS,CAAC,MAAMC,OAAO,CAAC,IAAI,CAACJ,GAAG,EAAE,WAAW,EAAEU,MAAM,CAAC,CAAC;EACtE;EAEA,MAAME,eAAeA,CACnBN,SAA4C,EAC5CC,KAAY,EACZC,KAAgB,EAChBC,MAAe,EAC2B;IAC1C,MAAMC,MAAM,GAAG,CACb,IAAAG,2CAA0B,EAACP,SAAS,CAAC,EACrCC,KAAK,EACLC,KAAK,EACLC,MAAM,CACP;IACD,OAAOP,WAAK,CAACC,SAAS,CAAC,MAAMC,OAAO,CAAC,IAAI,CAACJ,GAAG,EAAE,kBAAkB,EAAEU,MAAM,CAAC,CAAC;EAC7E;EACA,MAAMI,cAAcA,CAAA,EAAoB;IACtC,OAAOZ,WAAK,CAACC,SAAS,CAAC,MAAMC,OAAO,CAAC,IAAI,CAACJ,GAAG,EAAE,kBAAkB,CAAC,CAAC;EACrE;AACF;;AAEA;AAAAe,OAAA,CAAAjB,GAAA,GAAAA,GAAA;AACA,MAAMM,OAAO,GAAG,MAAAA,CACdY,aAAqB,EACrBC,MAAc,EACdP,MAAY,KACK;EACjB,MAAMQ,GAAG,GAAG,MAAM,IAAAC,mBAAK,EAACH,aAAa,EAAE;IACrCC,MAAM,EAAE,MAAM;IACdG,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;MACnBC,EAAE,EAAE,CAAC;MACLC,OAAO,EAAE,KAAK;MACdP,MAAM;MACNP;IACF,CAAC,CAAC;IACFe,OAAO,EAAE;MACP,cAAc,EAAE;IAClB;EACF,CAAC,CAAC;EACF,IAAIP,GAAG,CAACQ,MAAM,KAAK,GAAG,EAAE;IACtB,MAAM,IAAIC,KAAK,CAAE,yCAAwCT,GAAG,CAACQ,MAAO,EAAC,CAAC;EACxE;EACA,MAAME,IAAI,GAAG,MAAMV,GAAG,CAACW,IAAI,CAAC,CAAC;EAC7B,IAAID,IAAI,CAACE,KAAK,KAAKC,SAAS,EAAE;IAC5B,MAAM,IAAIJ,KAAK,CACZ,0CAAyCN,IAAI,CAACC,SAAS,CAACM,IAAI,CAACE,KAAK,CAAE,EACvE,CAAC;EACH;EACA,OAAOF,IAAI,CAACI,MAAM;AACpB,CAAC;AACD"}